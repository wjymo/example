用户下单，生成订单信息，选择支付，通过订单号，appid，回调通知地址等参数去请求第三方支付服务，第三方服务，如微信，返回字符串，前端将这个字符串生成二维码，供用户扫码支付，用户扫码后，微信会告知用户扫码成功，并异步通知我们自己的服务告知支付结果，也可以我们主动去请求微信的查询订单状态接口，但支付结果为成功时，修改订单状态，如果支付失败，修改订单状态并去调用微信api关闭订单
微信的异步回调通知可能会因为网络原因导致一直没通知到，可靠性不能百分之百保证，可以使用延迟队列，在生成订单的时候，向一个死信队列中发当前订单号，此队列可设定一个消息过期时间，如30分钟，当时间到达后，此队列会将消息转发到另一个队列q，后端服务一直在监听队列q，当监听到后，去数据库查看此订单状态，如果还不是成功，就去调用微信api关闭订单

当为微服务模式时，支付系统和订单系统是分离的，当支付成功后，通过mq通知订单系统修改状态，和上面同理，当支付系统和微信之间因为网络等因素没有接收到通知，也可以使用延迟队列的方式直接去微信查看订单状态


阿里回调验签：
将请求中的参数全部拿出来，封装成一个map，之后还将外部订单号，阿里自己的订单号，还有订单状态拿出来，调用支付宝的验签方法（此方法只用到上面的map，支付宝公钥，字符集和签名方式），验签通过返回true，即可修改订单状态，如果验签成功的话最后返回给支付宝一个字符串--success，这样支付宝就不会再次发送异步通知了
